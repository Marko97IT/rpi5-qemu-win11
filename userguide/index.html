<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>User Guide - Win11 on RPI5 with QEMU</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../css/copytoclipboard.min.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Win11 on RPI5 with QEMU</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">User Guide</a>
                            </li>
                            <li class="nav-item">
                                <a href="../about/" class="nav-link">About</a>
                            </li>
                            <li class="nav-item">
                                <a href="../faq/" class="nav-link">F.A.Q.</a>
                            </li>
                            <li class="nav-item">
                                <a href="../donate/" class="nav-link">Donate</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../about/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="true">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#user-guide" class="nav-link">User Guide</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#prepare-the-raspberry-pi-5" class="nav-link">Prepare the Raspberry Pi 5</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#first-boot" class="nav-link">First boot</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#install-qemu-and-dependencies" class="nav-link">Install QEMU and dependencies</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#configure-the-tpm" class="nav-link">Configure the TPM</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#configure-the-vm" class="nav-link">Configure the VM</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#install-windows-11" class="nav-link">Install Windows 11</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#use-screen" class="nav-link">Use Screen</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#enjoy-windows-11" class="nav-link">Enjoy Windows 11</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="user-guide">User Guide</h1>
<p>&nbsp;</p>
<p>Below you will find all the illustrated steps to perform a correct installation.</p>
<p>&nbsp;</p>
<h2 id="prepare-the-raspberry-pi-5">Prepare the Raspberry Pi 5</h2>
<p>Download the software <strong>Raspberry Pi Imager</strong> which you will use to configure and write to the drive you will mount on your Raspberry Pi 5 the host operating system. The software can be used from Windows, MacOS and Ubuntu. You can download it <a href="https://www.raspberrypi.com/software/">here</a>.</p>
<p>After installing and opening it you will see the following screen.</p>
<p><img alt="Raspberry Pi Imager" src="../img/raspberrypiimager.webp" /></p>
<p>In 'CHOOSE DEVICE' you have to select 'Raspberry Pi 5'</p>
<p><img alt="Raspberry Pi Imager - Choose device" src="../img/choosedevice.webp" /></p>
<p>In 'CHOOSE OS' you have to select 'Other general-purpose OS', then select 'Ubuntu', then an Ubuntu Server LTS edition.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>I decided to use Ubuntu Server as it is a very lightweight operating system and does not interfere with running Windows.</p>
</div>
<p><img alt="Raspberry Pi Imager - Choose OS 1" src="../img/othergeneralpurposeos.webp" /></p>
<p><img alt="Raspberry Pi Imager - Choose OS 2" src="../img/ubuntuselection.webp" /></p>
<p><img alt="Raspberry Pi Imager - Choose OS 3" src="../img/ubuntuserverltsselection.webp" /></p>
<p>Finally, in 'CHOOSE STORAGE' you have to select the drive that you will use in your Raspberry Pi 5.</p>
<p><img alt="Raspberry Pi Imager - Choose storage" src="../img/driveselection.webp" /></p>
<p>The 'NEXT' button will then unlock and once clicked you will be able to customize your installation. Just click 'EDIT SETTINGS' and set appropiate settings.</p>
<p>In the 'GENERAL' tab flag the option 'Set username and password'. You need it to authenticate through SSH later. Then if you wanna use the WiFi, flag the option 'Configure WiFi'. In the 'SERVICES' tab flag the option 'Enable SSH'. Finally click 'SAVE'.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Avoid to use the WiFi. Sometimes <strong>WiFi 5GHz</strong> and <strong>WPA3-Personal</strong> as authentication may not work properly. Use the Ethernet connection instead.</p>
</div>
<p><img alt="Raspberry Pi Imager - General Settings" src="../img/generalsettings.webp" /></p>
<p><img alt="Raspberry Pi Imager - Services Settings" src="../img/servicessettings.webp" /></p>
<p>Now, you are ready! Just click 'Yes' to apply your settings and the host OS will be installed in your Raspberry Pi 5. It usually takes a few minutes and depends mostly on the speed of your Internet connection.</p>
<p><img alt="Raspberry Pi Imager - Set Settings" src="../img/setsettings.webp" /></p>
<p>&nbsp;</p>
<h2 id="first-boot">First boot</h2>
<p>Plug the drive into your Raspberry Pi 5 then power it up and wait a few minutes for it to be ready to SSH into.</p>
<p>Before proceeding you will need to locate the local IP address where your Raspberry Pi 5 is connected. To do this, access the configuration page of your router and check which is the correct IP.</p>
<p>Once you have found the IP address, connect to your Raspberry Pi 5 with an SSH client. For example, on Windows you can use the <code>ssh</code> command to connect with the Terminal or you can use <a href="https://www.putty.org/">PuTTY</a>. Enter the credentials you configured earlier and connect.</p>
<p>Before you begin you will need to update your host operating system. Since we are using Ubuntu you will need to run these commands.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>upgrade<span class="w"> </span>-y
</code></pre></div>

<p>Install Raspberry Pi kernel drivers with this command (optional).</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>linux-raspi<span class="w"> </span>-y
</code></pre></div>

<p>&nbsp;</p>
<h2 id="install-qemu-and-dependencies">Install QEMU and dependencies</h2>
<p>Now you are ready to start installing all the dependencies needed to run the VM with Windows 11. We then install <strong>QEMU</strong> with the following command.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>qemu-system-arm<span class="w"> </span>qemu-utils<span class="w"> </span>-y
</code></pre></div>

<p>Install <strong>PipeWire</strong>, a media server used in many modern Linux systems to handle audio and video.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>pipewire<span class="w"> </span>pipewire-audio-client-libraries<span class="w"> </span>-y
</code></pre></div>

<p>&nbsp;</p>
<h2 id="configure-the-tpm">Configure the TPM</h2>
<p>Windows 11 except the IoT version, requires the TPM to run so we need to configure it.</p>
<p>Install <strong>swtpm</strong>, a package to emulate the TPM.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>swtpm<span class="w"> </span>-y
</code></pre></div>

<p>Create a folder to save TPM things in.</p>
<div class="codehilite"><pre><span></span><code>mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/win11tpm
</code></pre></div>

<p>Create a service. This will make it start automatically every time you reboot your Rasperry Pi 5.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/systemd/system/swtpm.service
</code></pre></div>

<p>Paste this content into and save.</p>
<div class="codehilite"><pre><span></span><code>[Unit]
Description=swtpm service
After=network.target

[Service]
ExecStart=/usr/bin/swtpm socket --tpm2 --tpmstate dir=/tmp/win11tpm --ctrl type=unixio,path=/tmp/win11tpm/swtpm-sock
Restart=always
User=root
Group=root

[Install]
WantedBy=multi-user.target
</code></pre></div>

<p>Reload the services of <code>systemd</code>.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
</code></pre></div>

<p>Enable and start the service.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>swtpm.service
</code></pre></div>

<p>Check if everything it's ok.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>swtpm.service
</code></pre></div>

<p>&nbsp;</p>
<h2 id="configure-the-vm">Configure the VM</h2>
<p>To make the VM creation process easier, let's create a new folder that contains everything essential to start the VM. We call the new folder <code>qemu</code>.</p>
<div class="codehilite"><pre><span></span><code>mkdir<span class="w"> </span>qemu<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>qemu
</code></pre></div>

<p>Now let's create the image file that contains Windows when we use the VM. Windows 11 requires <strong>64 GB or more space</strong> to run.
In this case I will create a drive with 128 GB of space. You can increase or decrease the space if you want.</p>
<div class="codehilite"><pre><span></span><code>qemu-img<span class="w"> </span>create<span class="w"> </span>win11-arm64.img<span class="w"> </span>128G
</code></pre></div>

<p>The file name of the drive it's <code>win11-arm64.img</code>. You can choose another name if you want.</p>
<p>Now you need the UEFI firmware to run Windows 11 correctly. You can download required files with sending these commands.</p>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/Marko97IT/rpi5-qemu-win11.github.io/refs/heads/main/assets/uefi/QEMU_EFI-pflash.raw
</code></pre></div>

<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/Marko97IT/rpi5-qemu-win11.github.io/refs/heads/main/assets/uefi/QEMU_VARS-pflash.raw
</code></pre></div>

<p>Download VirtIO drivers with this command.</p>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://raw.githubusercontent.com/Marko97IT/rpi5-qemu-win11.github.io/refs/heads/main/assets/drivers/virtio-win-0.1.266.iso
</code></pre></div>

<p>Also, you need to download the ISO of Windows 11 ARM64. You can use the command <code>wget</code> to download it from the Raspberry Pi 5.
An example of command can be this.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Consider the <strong>Windows 11 IoT Enterprise</strong> edition. It is specifically built for IoT devices.</p>
</div>
<div class="codehilite"><pre><span></span><code>wget<span class="w"> </span>https://site.com/urlwin11.iso
</code></pre></div>

<p>Now, you can start the VM and install Windows 11. Run this command. If you have a little bit of skill you can tweak the command to customize your VM.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The command sets 7 GB of RAM because I have 8 GB of RAM. If you have a Raspberry Pi 5 with less RAM, change the <code>-m 7G</code> value to a different amount.
Leave a minimum amount of RAM for the host OS or you may experience instability. 1 GB of memory should be sufficient.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Change the value <code>win11.iso</code> with the name of your ISO.</p>
</div>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>qemu-system-aarch64<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-M<span class="w"> </span>virt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-m<span class="w"> </span>7G<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-cpu<span class="w"> </span>max<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-smp<span class="w"> </span><span class="m">4</span>,cores<span class="o">=</span><span class="m">2</span>,threads<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--accel<span class="w"> </span>kvm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>pflash,file<span class="o">=</span>./QEMU_EFI-pflash.raw,format<span class="o">=</span>raw<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>pflash,file<span class="o">=</span>./QEMU_VARS-pflash.raw,format<span class="o">=</span>raw<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>ramfb<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>qemu-xhci<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-ehci<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-kbd<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-tablet<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>virtio-gpu<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-storage,drive<span class="o">=</span>install<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>none,id<span class="o">=</span>install,format<span class="o">=</span>raw,media<span class="o">=</span>cdrom,file<span class="o">=</span>./win11.iso<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-storage,drive<span class="o">=</span>virtio-drivers<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>none,id<span class="o">=</span>virtio-drivers,format<span class="o">=</span>raw,media<span class="o">=</span>cdrom,file<span class="o">=</span>./virtio-win-0.1.266.iso<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-chardev<span class="w"> </span>socket,id<span class="o">=</span>chrtpm,path<span class="o">=</span>/tmp/win11tpm/swtpm-sock<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-tpmdev<span class="w"> </span>emulator,id<span class="o">=</span>tpm0,chardev<span class="o">=</span>chrtpm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>tpm-tis-device,tpmdev<span class="o">=</span>tpm0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-nic<span class="w"> </span>user,model<span class="o">=</span>virtio-net-pci<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>virtio,id<span class="o">=</span>system,format<span class="o">=</span>raw,file<span class="o">=</span>./win11-arm64.img<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-vnc<span class="w"> </span>:0
</code></pre></div>

<p>&nbsp;</p>
<h2 id="install-windows-11">Install Windows 11</h2>
<p>Since Windows setup requires you to press any key to start the installation, before running the command to start the VM, install a <strong>VNC client</strong> and have it ready to connect. The IP address for the VNC connection will be the same as the one you use to connect with SSH to your Raspberry Pi 5.
Once you run the command to start the VM quickly connect to VNC to start the installation when prompted.</p>
<p><img alt="Windows Setup - Press any key" src="../img/windowsinstallpressanykey.webp" /></p>
<p><img alt="Windows Setup - First boot" src="../img/windowsinstallfirstboot.webp" /></p>
<p><img alt="Windows Setup - First step" src="../img/windowsinstallfirststep.webp" /></p>
<p>Most likely your Windows installation does not have the drivers needed to view the disks. You will need to install the drivers to continue. Click 'Load Driver' then press 'Browse'.</p>
<p><img alt="Windows Setup - Load driver" src="../img/windowsinstallloaddriver.webp" /></p>
<p><img alt="Windows Setup - Browse driver" src="../img/windowsinstallbrowsedriver.webp" /></p>
<p>Navigate to <code>E:\viostor\w11\ARM64</code> and continue. May be the drive letter isn't <code>E:</code>, so you have to select the drive named <code>virtio-win...</code>.</p>
<p><img alt="Windows Setup - Select driver" src="../img/windowsinstallselectdriver.webp" /></p>
<p>Select <code>Red Hat VirtIO SCSI controller</code> and press 'Install'.</p>
<p><img alt="Windows Setup - Select driver" src="../img/windowsinstallinstalldriver.webp" /></p>
<p>Now you can install Windows in Disk 0.</p>
<p><img alt="Windows Setup - Install Disk 0" src="../img/windowsinstallstart.webp" /></p>
<p><img alt="Windows Setup - Installing" src="../img/windowsinstallinstalling.webp" /></p>
<p>Now complete OOBE setting of Windows without the Internet connection.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If you want to connect to the VM with RDP, you will need to set a password for the user.</p>
</div>
<p><img alt="Windows Setup - OOBE" src="../img/windowsoobe.webp" /></p>
<p>When you're in the Desktop, go to Start and search 'Device Manager' and open it.</p>
<p><img alt="Windows Setup - Device Manager" src="../img/windowsdevicemanager.webp" /></p>
<p>Click the 'Add driver' button and navigate to the CD-ROM drive of VirIO drivers, then press 'Next'. Leave the flag 'Include subfolders' enabled.</p>
<p><img alt="Windows Setup - Search driver" src="../img/windowsadddriver.webp" /></p>
<p><img alt="Windows Setup - Search driver" src="../img/windowssearchdriver.webp" /></p>
<p><img alt="Windows Setup - Installing driver" src="../img/windowsinstallingdriver.webp" /></p>
<p>When the installation is finished, <strong>don't reboot Windows</strong>, just close the window.</p>
<p>Go to Start and search 'Remote desktop settings' and open it.</p>
<p><img alt="Windows Setup - Remote Desktop settings" src="../img/windowsrdpsettings.webp" /></p>
<p>Flag 'Remote Desktop' and press 'Confirm'. Now you can connect to the VM with RDP.</p>
<p><img alt="Windows Setup - Enable Remote Desktop" src="../img/windowsrdpenable.webp" /></p>
<p>Finally, shutdown Windows and stop the VM by pressing CTRL + C in the SSH console.</p>
<p>&nbsp;</p>
<h2 id="use-screen">Use Screen</h2>
<p>To keep the VM alive and be able to exit the SSH console we use a very powerful tool called <code>screen</code>.</p>
<p>Run this command to create a new screen.</p>
<div class="codehilite"><pre><span></span><code>screen<span class="w"> </span>-S<span class="w"> </span>VM
</code></pre></div>

<p>Run the command to run the VM. This time the command is little different since we don't need the VirtIO driver drive and the Windows installation drive.</p>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>qemu-system-aarch64<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-M<span class="w"> </span>virt<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-m<span class="w"> </span>7G<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-cpu<span class="w"> </span>max<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-smp<span class="w"> </span><span class="m">4</span>,cores<span class="o">=</span><span class="m">2</span>,threads<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--accel<span class="w"> </span>kvm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>pflash,file<span class="o">=</span>./QEMU_EFI-pflash.raw,format<span class="o">=</span>raw<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>pflash,file<span class="o">=</span>./QEMU_VARS-pflash.raw,format<span class="o">=</span>raw<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>qemu-xhci<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-ehci<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-kbd<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>usb-tablet<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>virtio-gpu<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-chardev<span class="w"> </span>socket,id<span class="o">=</span>chrtpm,path<span class="o">=</span>/tmp/win11tpm/swtpm-sock<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-tpmdev<span class="w"> </span>emulator,id<span class="o">=</span>tpm0,chardev<span class="o">=</span>chrtpm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-device<span class="w"> </span>tpm-tis-device,tpmdev<span class="o">=</span>tpm0<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-nic<span class="w"> </span>user,model<span class="o">=</span>virtio-net-pci,hostfwd<span class="o">=</span>tcp::3389-:3389<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-drive<span class="w"> </span><span class="k">if</span><span class="o">=</span>virtio,id<span class="o">=</span>system,format<span class="o">=</span>raw,file<span class="o">=</span>./win11-arm64.img<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-vnc<span class="w"> </span>:0
</code></pre></div>

<p>Then, you can exit the screen session pressing CTRL + A + D. You can see the screen sessions sending this command.</p>
<div class="codehilite"><pre><span></span><code>screen<span class="w"> </span>-ls
</code></pre></div>

<p>If the screen is enabled you'll see an output like it and VM will still up.</p>
<div class="codehilite"><pre><span></span><code>There is a screen on:
        8188.VM (12/10/24 08:15:42)     (Detached)
1 Socket in /run/screen/S-admin.
</code></pre></div>

<p>To resume the screen just run this command.</p>
<div class="codehilite"><pre><span></span><code>screen<span class="w"> </span>-r<span class="w"> </span>VM
</code></pre></div>

<p>&nbsp;</p>
<h2 id="enjoy-windows-11">Enjoy Windows 11</h2>
<p>The guide is now complete. Simply boot the VM with screen and you will have a fully functional Windows 11 VM.</p>
<p>You can connect with VNC or RDP using the host's IP address.</p>
<p><img alt="Windows 11" src="../img/windows.webp" /></p>
<p><img alt="Windows 11 - CPU Task Manager" src="../img/windowscpu.webp" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../js/copytoclipboard.min.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
